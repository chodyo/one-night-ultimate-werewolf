<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" />

        <style>
            body {
                font-family: Tahoma, Geneva, sans-serif;
            }
        </style>

        <!-- colyseus.js client -->
        <script
            type="text/javascript"
            src="https://raw.githack.com/colyseus/colyseus.js/master/dist/colyseus.js"
        ></script>
    </head>
    <body>
        <h1>
            <a href="https://github.com/colyseus/colyseus-examples"></a>
                <img
                    src="https://cdn.jsdelivr.net/gh/colyseus/colyseus@master/media/header.png"
                    height="100"
                    alt="colyseus"
                />
            </a>
        </h1>

        <strong>Your name</strong><br />

        <form id="nameForm">
            <input type="text" id="nameInput" value="" autofocus />
            <input type="submit" value="send" />
        </form>

        <script>
            var host = window.document.location.host.replace(/:.*/, "");

            var client = new Colyseus.Client(
                location.protocol.replace("http", "ws") + "//" + host + (location.port ? ":" + location.port : "")
            );
            client.joinOrCreate("my_room").then(room => {
                console.log("joined");
                room.onStateChange.once(function(state) {
                    console.log("initial room state:", state);
                });

                // new room state
                room.onStateChange(function(state) {
                    // this signal is triggered on each patch
                });

                // listen to patches coming from the server
                room.onMessage(function(message) {
                    var p = document.createElement("p");
                    p.innerText = message;
                    document.querySelector("#messages").appendChild(p);
                });

                // send message to room on submit
                document.querySelector("#nameForm").onsubmit = function(e) {
                    e.preventDefault();

                    var input = document.querySelector("#nameInput");

                    console.log("sending new name to server:", input.value);

                    // send data to room
                    room.send({ command: "setName", params: {name: input.value }});

                    // clear input
                    input.value = "";
                };
            });
        </script>
    </body>
</html>
