<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" />

        <style>
            body {
                font-family: Tahoma, Geneva, sans-serif;
            }
        </style>

        <!-- colyseus.js client -->
        <script
            type="text/javascript"
            src="https://raw.githack.com/colyseus/colyseus.js/master/dist/colyseus.js"
        ></script>
    </head>
    <body>
        <h1>
            <a href="https://github.com/colyseus/colyseus-examples"></a>
                <img
                    src="https://dl1.cbsistatic.com/i/2016/08/10/9efe9336-d20f-4f17-b79a-9d46644df6c3/bdd48ea08a22aaeaf554aff5b1cbc8e2/imgingest-5645171081042638537.png"
                    height="100"
                    alt="One Night Ultimate Werewolf"
                />
            </a>
        </h1>

        <strong>Your name</strong><br />

        <form id="nameForm">
            <input type="text" id="nameInput" value="" autofocus />
            <input type="submit" value="send" />
        </form>

        <div id="messages"></div>

        <hr/>

        <strong>Players</strong><br />

        <div id="players"></div>

        <script>
            const host = window.document.location.host.replace(/:.*/, "");

            const client = new Colyseus.Client(
                location.protocol.replace("http", "ws") + "//" + host + (location.port ? ":" + location.port : "")
            );
            client.joinOrCreate("my_room").then(room => {
                console.log("joined");
                room.onStateChange.once(function(state) {
                    console.log("initial room state:", state);
                    let players = state.players;
                    if (players.length > 0) {
                        players.forEach(function(player) {
                          let p = document.createElement("p");
                          p.innerText = player.name;
                          document.querySelector("#players").appendChild(p);
                        })
                    }
                });

                // new room state
                room.onStateChange(function(state) {
                    // this signal is triggered on each patch
                });

                // listen to patches coming from the server
                room.onMessage(function(message) {
                    let p = document.createElement("p");
                    p.innerText = message;
                    document.querySelector("#messages").appendChild(p);
                });

                // send message to room on submit
                document.querySelector("#nameForm").onsubmit = function(e) {
                    e.preventDefault();

                    let input = document.querySelector("#nameInput");

                    console.log("sending new name to server:", input.value);

                    // send data to room
                    room.send({ command: "setName", params: { name: input.value }});

                    // clear input
                    input.value = "";
                };
            });
        </script>
    </body>
</html>
